# キャッシュ機構

DocstringTranslation.jl は、翻訳結果をキャッシュすることで、API の使用量を抑え、ドキュメント生成の効率を向上させています。

## キャッシュの仕組み

### キャッシュディレクトリ

キャッシュは以下の場所に保存されます：

- デフォルト: `@get_scratch!("translation")` で指定されるディレクトリ
- カスタム: `switchtranslationcachedir!` 関数で指定したディレクトリ

### キャッシュの構造

キャッシュは以下のような構造で保存されます：

```
cache_directory/
├── original/          # 元のドキュメント
│   └── {hash}.json
└── translations/      # 翻訳済みドキュメント
    └── {hash}_{lang}.json
```

- `{hash}`: ドキュメントの内容から生成される SHA-256 ハッシュ
- `{lang}`: 翻訳先の言語コード（例：`ja`, `en`）

### キャッシュの動作

1. **キャッシュの確認**
   - ドキュメント生成時に、まず元のドキュメントのハッシュを計算
   - 対応する翻訳済みドキュメントがキャッシュに存在するか確認

2. **キャッシュの利用**
   - キャッシュに存在する場合：キャッシュから翻訳を読み込み
   - キャッシュに存在しない場合：OpenAI API を使用して翻訳を実行

3. **キャッシュの保存**
   - 新しい翻訳が生成された場合、キャッシュに保存
   - 元のドキュメントも同時に保存（将来の比較用）

## キャッシュの利点

1. **API 使用量の削減**
   - 同じドキュメントの再翻訳を避けることで、API の使用量を最小限に抑制

2. **生成速度の向上**
   - キャッシュからの読み込みは API 呼び出しよりも高速
   - 特に大規模なドキュメント生成時に効果的

3. **一貫性の確保**
   - 同じドキュメントに対して常に同じ翻訳を提供
   - 翻訳の品質と一貫性を維持

## キャッシュの管理

### キャッシュのクリア

キャッシュディレクトリを直接削除することで、キャッシュをクリアできます：

```julia
# キャッシュディレクトリのパスを取得
cache_dir = DocstringTranslation.TRANSLATION_CACHE_DIR[]

# キャッシュをクリア（必要な場合）
rm(cache_dir, force=true, recursive=true)
```

### キャッシュの移動

キャッシュディレクトリを変更する場合：

```julia
# 新しいキャッシュディレクトリを設定
switchtranslationcachedir!("path/to/new/cache/directory")
```
